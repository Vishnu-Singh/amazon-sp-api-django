{% extends 'documentation/base.html' %}

{% block title %}API Reference{% endblock %}

{% block content %}
<div class="content">
    <h2>API Reference</h2>
    
    <p>This page provides comprehensive documentation for all 18 Amazon SP-API categories integrated in this project. Each category proxies requests to the official Amazon Selling Partner API.</p>
    
    <p><strong>Base URL:</strong> <code>http://localhost:8000</code></p>
    <p><strong>JSON API Spec:</strong> <a href="{% url 'documentation:api-reference-json' %}">Download OpenAPI specification</a></p>
    
    {% for category_key, category in api_categories.items %}
    <div class="api-category">
        <h3>{{ category.name }}</h3>
        <p>{{ category.description }}</p>
        <p><strong>Base Path:</strong> <code>{{ category.base_path }}</code></p>
        <p><strong>Amazon SP-API Version:</strong> <code>{{ category.version }}</code></p>
        
        {% for endpoint in category.endpoints %}
        <div class="api-endpoint">
            <div>
                <span class="badge badge-{{ endpoint.method|lower }}">{{ endpoint.method }}</span>
                <span class="endpoint-path">{{ endpoint.path }}</span>
            </div>
            <p><strong>Description:</strong> {{ endpoint.description }}</p>
            <p><strong>Proxies to:</strong> <code>{{ endpoint.sp_api_path }}</code></p>
            
            {% if endpoint.parameters %}
            <div class="params">
                <strong>Parameters:</strong>
                {% for param in endpoint.parameters %}
                <div class="param">
                    <strong>{{ param.name }}</strong>
                    {% if param.required %}<span class="required">(required)</span>{% else %}<span>(optional)</span>{% endif %}
                    - {{ param.description }}
                </div>
                {% endfor %}
            </div>
            {% endif %}
            
            <details style="margin-top: 1rem;">
                <summary style="cursor: pointer; font-weight: bold;">Example Request</summary>
                <pre style="margin-top: 0.5rem;"><code>curl -X {{ endpoint.method }} \
  "http://localhost:8000{{ endpoint.path }}" \
  -H "Content-Type: application/json"</code></pre>
            </details>
        </div>
        {% endfor %}
    </div>
    {% endfor %}
    
    <h3>üîê Authentication</h3>
    <p>All API endpoints proxy to Amazon SP-API which requires authentication. The current implementation includes a placeholder authentication framework. For production use, you need to:</p>
    <ul>
        <li>Implement full AWS Signature Version 4 signing</li>
        <li>Implement LWA (Login with Amazon) token refresh logic</li>
        <li>Handle token expiration and renewal</li>
        <li>Configure AWS IAM roles correctly</li>
    </ul>
    
    <h3>üìù Response Format</h3>
    <p>All endpoints return JSON responses in the following format:</p>
    <pre><code>{
  "status_code": 200,
  "data": { ... },  // Response from Amazon SP-API
  "headers": { ... }
}

// Or in case of errors:
{
  "status_code": 500,
  "error": "Error message",
  "message": "Human-readable error description"
}</code></pre>
    
    <h3>üåê Marketplace IDs</h3>
    <p>Common marketplace identifiers for Amazon SP-API:</p>
    <ul>
        <li><strong>US:</strong> ATVPDKIKX0DER</li>
        <li><strong>Canada:</strong> A2EUQ1WTGCTBG2</li>
        <li><strong>Mexico:</strong> A1AM78C64UM0Y8</li>
        <li><strong>UK:</strong> A1F83G8C2ARO7P</li>
        <li><strong>Germany:</strong> A1PA6795UKMFR9</li>
        <li><strong>France:</strong> A13V1IB3VIYZZH</li>
        <li><strong>Italy:</strong> APJ6JRA9NG5V4</li>
        <li><strong>Spain:</strong> A1RKKUPIHCS9HS</li>
        <li><strong>Japan:</strong> A1VC38T7YXB528</li>
    </ul>
    
    <h3>‚ö†Ô∏è Error Handling</h3>
    <p>The API handles errors gracefully and returns appropriate HTTP status codes:</p>
    <ul>
        <li><strong>200 OK:</strong> Successful request</li>
        <li><strong>400 Bad Request:</strong> Invalid request parameters</li>
        <li><strong>401 Unauthorized:</strong> Authentication failure</li>
        <li><strong>403 Forbidden:</strong> Insufficient permissions</li>
        <li><strong>404 Not Found:</strong> Resource not found</li>
        <li><strong>429 Too Many Requests:</strong> Rate limit exceeded</li>
        <li><strong>500 Internal Server Error:</strong> Server error or Amazon SP-API connection failure</li>
    </ul>
    
    <h3>üìö Additional Resources</h3>
    <ul>
        <li><a href="https://developer-docs.amazon.com/sp-api/" target="_blank">Official Amazon SP-API Documentation</a></li>
        <li><a href="https://github.com/amzn/selling-partner-api-docs" target="_blank">Amazon SP-API GitHub Repository</a></li>
    </ul>
</div>
{% endblock %}
